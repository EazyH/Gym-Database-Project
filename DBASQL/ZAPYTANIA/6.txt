SELECT KLUB.ID_KLUBU, KLUB.MIEJSCOWOSC, KLUB.ULICA, KLUB.NR_LOKALU, COUNT(*) AS "PODPISANE_UMOWY_KLUBU", TAB.NAZWISKO, TAB.PODPISANE_UMOWY_PRACOWNIKA
FROM KLUB LEFT JOIN PRACOWNIK ON KLUB.ID_KLUBU=PRACOWNIK.ID_KLUBU
RIGHT JOIN UMOWA ON PRACOWNIK.PESEL=UMOWA.PESEL
LEFT JOIN (SELECT PRACOWNIK.ID_KLUBU, PRACOWNIK.IMIE, PRACOWNIK.NAZWISKO, COUNT(*) AS "PODPISANE_UMOWY_PRACOWNIKA"
FROM PRACOWNIK INNER JOIN UMOWA ON PRACOWNIK.PESEL=UMOWA.PESEL
GROUP BY PRACOWNIK.ID_KLUBU, PRACOWNIK.IMIE, PRACOWNIK.NAZWISKO) AS "TAB" ON KLUB.ID_KLUBU=TAB.ID_KLUBU
GROUP BY KLUB.ID_KLUBU, KLUB.MIEJSCOWOSC, KLUB.ULICA, KLUB.NR_LOKALU, TAB.NAZWISKO, TAB.PODPISANE_UMOWY_PRACOWNIKA
ORDER BY PODPISANE_UMOWY_KLUBU DESC
